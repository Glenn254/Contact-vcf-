<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Panel - Contact Approvals</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f7f7f7; }
    h2 { margin-top: 30px; }
    button { margin: 5px; padding: 5px 10px; }
    li { list-style: none; background: white; margin: 5px 0; padding: 8px; border-radius: 5px; }
  </style>
</head>
<body>
  <h1>Admin Panel</h1>

  <h2>Pending Contacts</h2>
  <ul id="pendingList"></ul>

  <h2>Approved Contacts (<span id="approvedCount">0</span>)</h2>
  <ul id="approvedList"></ul>
  <button onclick="downloadVCF()">Download Approved VCF</button>

  <h2>Rejected Contacts</h2>
  <ul id="rejectedList"></ul>

  <script>
    async function loadContacts() {
      const res = await fetch('/contacts');
      const { approved, rejected } = await res.json();

      // Load pending contacts from contacts.json
      const pendingRes = await fetch('/contacts.json');
      const pendingContacts = await pendingRes.json();

      const approvedNums = approved.map(c => c.number);
      const rejectedNums = rejected.map(c => c.number);

      const pending = pendingContacts.filter(c => 
        !approvedNums.includes(c.number) && !rejectedNums.includes(c.number)
      );

      // Pending
      document.getElementById('pendingList').innerHTML = pending.map(c =>
        `<li>${c.name} - ${c.number}
          <button onclick="approveContact('${c.name}','${c.number}')">Approve</button>
          <button onclick="rejectContact('${c.name}','${c.number}')">Reject</button>
        </li>`
      ).join('');

      // Approved
      document.getElementById('approvedList').innerHTML = approved.map(c =>
        `<li>${c.name} - ${c.number} ✅</li>`
      ).join('');

      // Rejected
      document.getElementById('rejectedList').innerHTML = rejected.map(c =>
        `<li>${c.name} - ${c.number} ❌</li>`
      ).join('');

      document.getElementById('approvedCount').textContent = approved.length;
    }

    async function approveContact(name, number) {
      await fetch('/approve', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name, number })
      });
      loadContacts();
    }

    async function rejectContact(name, number) {
      await fetch('/reject', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name, number })
      });
      loadContacts();
    }

    function downloadVCF() {
      window.location.href = '/download-vcf';
    }

    window.onload = loadContacts;
  </script>
</body>
</html>
